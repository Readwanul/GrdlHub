<!DOCTYPE html>
<html>
<head>
  <title>Auth Flow Test</title>
  <style>
    body { font-family: monospace; padding: 2rem; }
    .log { margin: 0.5rem 0; padding: 0.5rem; background: #f5f5f5; }
    .error { background: #fee; color: #a00; }
    .success { background: #efe; color: #0a0; }
    .warning { background: #ffd; color: #a60; }
  </style>
</head>
<body>
  <h1>üîê Authentication Flow Test</h1>
  <div id="logs"></div>
  
  <script type="module">
    const logs = document.getElementById('logs');
    
    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `log ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logs.appendChild(div);
      console.log(message);
    }
    
    async function testAuthFlow() {
      try {
        log('üöÄ Starting auth flow test...');
        
        // Step 1: Import auth standalone
        log('üì¶ Importing auth-standalone.js...');
        const { AuthAPI } = await import('./src/auth-standalone.js');
        log('‚úÖ auth-standalone.js imported', 'success');
        
        // Step 2: Initialize auth
        log('üîß Initializing auth...');
        await AuthAPI.initializeStandaloneAuth();
        log('‚úÖ Auth initialized', 'success');
        
        // Step 3: Check current user
        log('üë§ Checking current user...');
        const user = AuthAPI.getCurrentAuthUser();
        
        if (user) {
          log(`‚úÖ User found: ${user.email}`, 'success');
          log(`Email verified: ${user.emailVerified}`, user.emailVerified ? 'success' : 'warning');
          log(`Provider data: ${JSON.stringify(user.providerData)}`, 'info');
          
          // Step 4: Try to load main app
          log('üöÄ Testing main app import...');
          const { default: initMainApp } = await import('./src/main-app.js');
          log('‚úÖ Main app imported', 'success');
          
          log('‚ö†Ô∏è Would now call initMainApp() but stopping here to avoid side effects', 'warning');
          
        } else {
          log('‚ÑπÔ∏è No authenticated user found - this is expected if not signed in', 'warning');
          log('üîó To test with authentication:');
          log('1. Go to auth.html');
          log('2. Enter a pre-approved email');
          log('3. Check the magic link in your email');
          log('4. Come back to this page');
        }
        
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
        log(`Stack: ${error.stack}`, 'error');
      }
    }
    
    testAuthFlow();
  </script>
</body>
</html>
